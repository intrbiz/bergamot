<!DOCTYPE balsa SYSTEM "http://balsa.intrbiz.net/balsa.dtd">
<?RenderLibrary com.intrbiz.balsa?>
<!-- The index view -->
<fragment xmlns="com.intrbiz.balsa">
	<div class="col12" style="margin-bottom: 20px;">
		<h2>Teams</h2>
		<p class="text-body">
			This #{lc(summary)} can be a member of more than one team.
		</p>
    	<ul id="teams">
	    	<data-set var="the_team" value="#{configuration.teams}">
	    		<li>
    				<select name="teams[#{the_team_rownum}]" id="teams_#{the_team_rownum}">
    					<data-set var="team" value="#{teams}">
    						<option rendered="#{the_team == team.name}" selected="selected" value="#{team.name}">#{coalesce(team.summary, team.name)}</option>
    						<option rendered="#{the_team != team.name}" value="#{team.name}">#{coalesce(team.summary, team.name)}</option>
    					</data-set>
    				</select>
   					<a class="remove" href="#remove">Remove</a>
   				</li>
   			</data-set>
   			<li id="add_team_row">
   				<!-- this select is used only for a template -->
  					<select name="available_teams" id="available_teams" style="display: none;">
   					<data-set var="team" value="#{teams}">
   						<option value="#{team.name}">#{coalesce(team.summary, team.name)}</option>
   					</data-set>
   				</select>
  				<a class="add" id="add_team" href="#add">Add Team</a>
   			</li>
  		</ul>
		<script type="text/javascript">
			(function() {
			
				function update_teams() {
					$('#excludes select').each(function(i, e) {
						if ($(e).attr('id') != 'available_teams') {
							$(e).attr('id', 'extends_' + i);
							$(e).attr('name', 'extends[' + i + ']');
						}
					});
				}
				
				function remove_team(ev) {
					ev.preventDefault();
					$(this).parent().remove();
					update_teams();
				}
				
				function add_team(ev) {
					ev.preventDefault();
					// select
					var sel = $('#available_teams').clone();
					$(sel).attr('id', '');
					$(sel).attr('name', '');
					$(sel).attr('style', '');
					// remove
					var rm  = document.createElement('a');
					$(rm).attr('href', '#remove');
					$(rm).text('Remove');
					$(rm).attr('class', 'remove');
					// containers
					var li = document.createElement('li');
					$(li).html([sel, rm]);
					// insert
					$('#add_team_row').before(li);
					// actions
					$(rm).click(remove_team);
					// update
					update_teams();
				}
				
				// setup
				$('#add_team').click(add_team);
				$('#excludes .remove').click(remove_team);
			})();
		</script>
		<style>
			#teams {
				clear: both;
			}
			#teams li {
				display: block;
				float: left;
				background-color: #EEE;
				border-radius: 5px;
				padding: 5px 10px;
				margin: 10px 5px 10px 0px;
				height: 40px;
			}
			
			#teams .add {
				background: transparent url('/list-add.png') top left no-repeat;
				height: 22px;
				text-indent: 27px;
				line-height: 22px;
				overflow: hidden;
				display: block;
				float: right;
				margin-top: 10px;
			}
			
			#teams .remove {
				background: transparent url('/edit-delete.png') top left no-repeat;
				width: 22px;
				height: 22px;
				text-indent: 10000px;
				overflow: hidden;
				display: block;
				float: right;
				margin-top: 10px;
			}
			
			#add_team_row {
				background-color: #FFF !important;
			}
		</style>
	</div>
</fragment>