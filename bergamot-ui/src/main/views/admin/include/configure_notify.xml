<!DOCTYPE balsa SYSTEM "http://balsa.intrbiz.net/balsa.dtd">
<?RenderLibrary com.intrbiz.balsa?>
<!-- The index view -->
<fragment xmlns="com.intrbiz.balsa">
		<div class="col12" style="margin-bottom: 20px;">
		<h2>Notify</h2>
		<p class="text-body">
			Who should receive notifications about this check.
		</p>
		<h4 style="clear: both;">Notify Teams</h4>
		<ul id="notify_teams">
			<data-set var="team" value="#{configuration.notify.teams}">
				<li>
					<select name="notify_team[#{team_rownum}]" id="notify_team_#{team_rownum}">
						<data-set var="a_team" value="#{teams}">
							<option rendered="#{team == a_team.name}" selected="selected" value="#{a_team.name}">#{coalesce(a_team.summary, a_team.name)}</option>
							<option rendered="#{team != a_team.name}" value="#{a_team.name}">#{coalesce(a_team.summary, a_team.name)}</option>
						</data-set>
					</select>
					<a class="remove" href="#remove">Remove</a>
				</li>
			</data-set>
			<li id="add_notify_team_row">
				<select id="available_notify_teams" style="display: none;">
					<data-set var="a_team" value="#{teams}">
						<option value="#{a_team.name}">#{coalesce(a_team.summary, a_team.name)}</option>
					</data-set>
				</select>
				<a class="add" id="add_notify_team" href="#add">Notify Team</a>
			</li>
		</ul>
	</div>
	<script type="text/javascript">
		(function() {
		
			function update_notify_teams() {
				$('#notify_teams select').each(function(i, e) {
					if ($(e).attr('id') != 'available_notify_teams') {
						$(e).attr('id', 'timerange_' + i);
						$(e).attr('name', 'timerange[' + i + ']');
					}
				});
			}
			
			function remove_notify_team(ev) {
				ev.preventDefault();
				$(this).parent().remove();
				update_notify_teams();
			}
			
			function add_notify_team(ev) {
				ev.preventDefault();
				// input
				var sel = $('#available_notify_teams').clone();
				$(sel).attr('id', '');
				$(sel).attr('name', '');
				$(sel).attr('style', '');
				// remove
				var rm  = document.createElement('a');
				$(rm).attr('href', '#remove');
				$(rm).text('Remove');
				$(rm).attr('class', 'remove');
				// containers
				var li = document.createElement('li');
				$(li).html([sel, rm]);
				// insert
				$('#add_notify_team_row').before(li);
				// actions
				$(rm).click(remove_notify_team);
				// update
				update_notify_teams();
			}
			
			$('#add_notify_team').click(add_notify_team);
			$('#notify_teams .remove').click(remove_notify_team);
		})();
	</script>
</fragment>