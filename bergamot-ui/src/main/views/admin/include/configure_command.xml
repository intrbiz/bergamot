<!DOCTYPE balsa SYSTEM "http://balsa.intrbiz.net/balsa.dtd">
<?RenderLibrary com.intrbiz.balsa?>
<!-- The index view -->
<fragment xmlns="com.intrbiz.balsa">
	<div class="col12" style="margin-bottom: 20px;">
		<h2>Command Details</h2>
		<p class="text-body">
			Configure how this command should be executed.
		</p>
		<p class="field">
			<label for="summary">Check Engine</label>
			<input type="text" name="engine" id="engine" placeholder="nagios" value="#{coalesce(configuration.engine, '')}"/>
		</p>
		<p class="field">
			<label for="summary">Check Executor</label>
			<input type="text" name="executor" id="executor" placeholder="" value="#{coalesce(configuration.executor, '')}"/>
		</p>
		<div id="parameters">
			<h3>Parameters</h3>
			<p class="text-body">
				
			</p>
			<ul>
				<data-set var="parameter" value="#{configuration.parameters}">
					<li>
						<a href="#remove" class="remove">Remove</a>
						<p class="field name">
							<label for="parameter_name[#{parameter_rownum}]">Name</label>
							<input type="text" name="parameter_name[#{parameter_rownum}]" id="parameter_name[#{parameter_rownum}]" value="#{parameter.name}"/>
						</p>
						<p class="field description">
							<label for="parameter_description[#{parameter_rownum}]">Description</label>
							<input type="text" name="parameter_description[#{parameter_rownum}]" id="parameter_description[#{parameter_rownum}]" value="#{coalesce(parameter.description, '')}"/>
						</p>
						<p class="field area value">
							<label for="parameter_value[#{parameter_rownum}]">Value</label>
							<textarea name="parameter_value[#{parameter_rownum}]" id="parameter_value[#{parameter_rownum}]">#{coalesce(parameter.valueOrText, '')}</textarea>
						</p>
					</li>
				</data-set>
				<li id="add_parameter_row">
						<p id="parameter_template_name" class="field name" style="display: none;">
							<label for="parameter_name[#{parameter_rownum}]">Name</label>
							<input type="text" id="parameter_template_name_input"/>
						</p>
						<p id="parameter_template_description" class="field description" style="display: none;">
							<label for="parameter_description[#{parameter_rownum}]">Description</label>
							<input type="text" id="parameter_template_description_input"/>
						</p>
						<p id="parameter_template_value" class="field area value" style="display: none;">
							<label for="parameter_value[#{parameter_rownum}]">Value</label>
							<textarea id="parameter_template_value_textarea"></textarea>
						</p>
                	<a class="add" id="add_parameter" href="#add">Add Parameter</a>
            	</li>
			</ul>
		</div>
	</div>
	<script type="text/javascript">
		(function() {
		
			function update_parameters() {
                $('#parameters p.name input[type=text]').each(function(i, e) {
                	if ($(e).attr('id') != 'parameter_template_name_input') {
                    	$(e).attr('id', 'parameter_name_' + i);
                    	$(e).attr('name', 'parameter_name[' + i + ']');
                    }
                });
                $('#parameters p.description input[type=text]').each(function(i, e) {
                	if ($(e).attr('id') != 'parameter_template_description_input') {
                    	$(e).attr('id', 'parameter_description_' + i);
                    	$(e).attr('name', 'parameter_description[' + i + ']');
                    }
                });
                $('#parameters p.value textarea').each(function(i, e) {
                	if ($(e).attr('id') != 'parameter_template_value_textarea') {
                    	$(e).attr('id', 'parameter_value_' + i);
                    	$(e).attr('name', 'parameter_value[' + i + ']');
                    }
                });
            }
            
            function remove_parameter(ev) {
                ev.preventDefault();
                $(this).parent().remove();
                update_parameters();
            }
            
            function add_parameter(ev) {
                ev.preventDefault();
                // remove
                var rm  = document.createElement('a');
                $(rm).attr('href', '#remove');
                $(rm).text('Remove');
                $(rm).attr('class', 'remove');
                // fields
                var fn = $('#parameter_template_name').clone();
                $(fn).attr('style', '');
                $(fn).attr('id', '');
                var fd = $('#parameter_template_description').clone();
                $(fd).attr('style', '');
                $(fd).attr('id', '');
                var fv = $('#parameter_template_value').clone();
                $(fv).attr('style', '');
                $(fv).attr('id', '');
                // containers
                var li = document.createElement('li');
                $(li).html([rm, fn, fd, fv]);
                // insert
                $('#add_parameter_row').before(li);
                // actions
                $(rm).click(remove_parameter);
                // update
                update_parameters();
            }
            
            $('#add_parameter').click(add_parameter);
            $('#parameters .remove').click(remove_parameter);
            
		})()
	</script>
	<style>
		#parameters {
			float: left;
			clear: both;
		}
		
		#parameters ul {
			display: block;
			float: left;
		}
		
		#parameters li {
			display: block;
			float: left;
			clear: both;
			margin-bottom: 20px;
			background-color: #EEE;
			padding: 10px 0 0 10px;
			border-radius: 5px;
		}
		
		#parameters li p.field label {
			width: 190px;
		}
		
		#parameters li p.field textarea {
			width: 607px;
		}
		
		#parameters .add {
            background: transparent url('/list-add.png') top left no-repeat;
            height: 22px;
            text-indent: 27px;
            line-height: 22px;
            overflow: hidden;
            display: block;
            margin: 10px;
        }
            
        #parameters .remove {
            background: transparent url('/edit-delete.png') top left no-repeat;
            width: 22px;
            height: 22px;
            text-indent: 10000px;
            overflow: hidden;
            display: block;
            float: right;
            margin: 0 10px 10px 0;
        }
        
        #parameters li#add_parameter_row {
        	margin-bottom: 20px;
            background-color: #FFF;
            padding: 0px;
            border-radius: 5px;
            display: block;
            float: left;
            clear: both;
        }
	</style>
</fragment>