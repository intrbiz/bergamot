<!DOCTYPE balsa SYSTEM "http://balsa.intrbiz.net/balsa.dtd">
<?RenderLibrary com.intrbiz.balsa?>
<!-- The index view -->
<fragment xmlns="com.intrbiz.balsa">
    <div class="col12" style="margin-bottom: 20px;">
        <h2>Notifications</h2>
        <p class="text-body">
            When and how should notifications be sent when 
            a check alerts.
        </p>
        <p class="field">
			<label for="notifications">Configure Notifications</label>
			<input type="checkbox" name="notifications" id="notifications" value="yes" checked="checked" rendered="#{configuration.notifications != null}"/>
			<input type="checkbox" name="notifications" id="notifications" value="yes" rendered="#{configuration.notifications == null}"/>
		</p>
		<div id="notifications_configuration">
	        <p class="field">
				<label for="notifications_enabled">Notifications Enabled</label>
				<input type="checkbox" name="notifications_enabled" id="notifications_enabled" value="yes" checked="checked" rendered="#{configuration.notifications.getEnabledBooleanValue()}"/>
				<input type="checkbox" name="notifications_enabled" id="notifications_enabled" value="yes" rendered="#{! configuration.notifications.getEnabledBooleanValue()}"/>
			</p>
			<p class="field">
				<label for="notification_period">Notification Period</label>
				<select name="notification_period" id="notification_period">
					<option value="">Not Specified</option>
					<data-set var="a_timeperiod" value="#{timeperiods}">
						<option rendered="#{configuration.notifications.notificationPeriod == a_timeperiod.name}" selected="selected" value="#{a_timeperiod.name}">#{coalesce(a_timeperiod.summary, a_timeperiod.name)}</option>
						<option rendered="#{configuration.notifications.notificationPeriod != a_timeperiod.name}" value="#{a_timeperiod.name}">#{coalesce(a_timeperiod.summary, a_timeperiod.name)}</option>
					</data-set>
				</select>
			</p>
			<p class="field">
				<label for="notifications_on_alert">Notify On Alerts</label>
				<input type="checkbox" name="notifications_on_alert" id="notifications_on_alert" value="yes" checked="checked" rendered="#{configuration.notifications.getAlertsBooleanValue()}"/>
				<input type="checkbox" name="notifications_on_alert" id="notifications_on_alert" value="yes" rendered="#{! configuration.notifications.getAlertsBooleanValue()}"/>
			</p>
			<p class="field">
				<label for="notifications_on_recovery">Notify On Recovery</label>
				<input type="checkbox" name="notifications_on_recovery" id="notifications_on_recovery" value="yes" checked="checked" rendered="#{configuration.notifications.getRecoveryBooleanValue()}"/>
				<input type="checkbox" name="notifications_on_recovery" id="notifications_on_recovery" value="yes" rendered="#{! configuration.notifications.getRecoveryBooleanValue()}"/>
			</p>
			<p class="field">
				<label for="notifications_ignore_pending">Ignore Pending Notifications</label>
				<input type="checkbox" name="notifications_ignore_pending" id="notifications_ignore_pending" value="yes" checked="checked" rendered="#{configuration.notifications.isIgnore('pending')}"/>
				<input type="checkbox" name="notifications_ignore_pending" id="notifications_ignore_pending" value="yes" rendered="#{! configuration.notifications.isIgnore('pending')}"/>
			</p>
			<p class="field">
				<label for="notifications_ignore_ok">Ignore OK Notifications</label>
				<input type="checkbox" name="notifications_ignore_ok" id="notifications_ignore_ok" value="yes" checked="checked" rendered="#{configuration.notifications.isIgnore('ok')}"/>
				<input type="checkbox" name="notifications_ignore_ok" id="notifications_ignore_ok" value="yes" rendered="#{! configuration.notifications.isIgnore('ok')}"/>
			</p>
			<p class="field">
				<label for="notifications_ignore_warning">Ignore Warning Notifications</label>
				<input type="checkbox" name="notifications_ignore_warning" id="notifications_ignore_warning" value="yes" checked="checked" rendered="#{configuration.notifications.isIgnore('warning')}"/>
				<input type="checkbox" name="notifications_ignore_warning" id="notifications_ignore_warning" value="yes" rendered="#{! configuration.notifications.isIgnore('warning')}"/>
			</p>
			<p class="field">
				<label for="notifications_ignore_critical">Ignore Critical Notifications</label>
				<input type="checkbox" name="notifications_ignore_critical" id="notifications_ignore_critical" value="yes" checked="checked" rendered="#{configuration.notifications.isIgnore('critical')}"/>
				<input type="checkbox" name="notifications_ignore_critical" id="notifications_ignore_critical" value="yes" rendered="#{! configuration.notifications.isIgnore('critical')}"/>
			</p>
			<p class="field">
				<label for="notifications_ignore_unknown">Ignore Unknown Notifications</label>
				<input type="checkbox" name="notifications_ignore_unknown" id="notifications_ignore_unknown" value="yes" checked="checked" rendered="#{configuration.notifications.isIgnore('unknown')}"/>
				<input type="checkbox" name="notifications_ignore_unknown" id="notifications_ignore_unknown" value="yes" rendered="#{! configuration.notifications.isIgnore('unknown')}"/>
			</p>
			<p class="field">
				<label for="notifications_ignore_timeout">Ignore Timeout Notifications</label>
				<input type="checkbox" name="notifications_ignore_timeout" id="notifications_ignore_timeout" value="yes" checked="checked" rendered="#{configuration.notifications.isIgnore('timeout')}"/>
				<input type="checkbox" name="notifications_ignore_timeout" id="notifications_ignore_timeout" value="yes" rendered="#{! configuration.notifications.isIgnore('timeout')}"/>
			</p>
			<p class="field">
				<label for="notifications_ignore_error">Ignore Error Notifications</label>
				<input type="checkbox" name="notifications_ignore_error" id="notifications_ignore_error" value="yes" checked="checked" rendered="#{configuration.notifications.isIgnore('error')}"/>
				<input type="checkbox" name="notifications_ignore_error" id="notifications_ignore_error" value="yes" rendered="#{! configuration.notifications.isIgnore('error')}"/>
			</p>
			<p class="field">
				<label for="notifications_all_engines">Use All Notification Engines</label>
				<input type="checkbox" name="notifications_all_engines" id="notifications_all_engines" value="yes" checked="checked" rendered="#{configuration.notifications.getAllEnginesEnabledBooleanValue()}"/>
				<input type="checkbox" name="notifications_all_engines" id="notifications_all_engines" value="yes" rendered="#{! configuration.notifications.getAllEnginesEnabledBooleanValue()}"/>
			</p>
		</div>
	</div>
	<div class="col12" style="margin-bottom: 20px;">
      	<h3>Notification Engines</h3>
      	<p class="text-body">
			Notifications can be configured at a per notification engine level.
        </p>
		<ul id="notification_engines">
			<data-set var="notification_engine" value="#{configuration.notifications.notificationEngines}">
				<li>
					<a href="#remove" class="remove">Remove</a>
					<p class="field engine">
						<label for="notification_engine_engine_[#{notification_engine_rownum}]">Notification Engine</label>
						<input type="text" name="notification_engine_engine_[#{notification_engine_rownum}]" id="notification_engine_engine_#{notification_engine_rownum}" value="#{notification_engine.engine}"/>
					</p>
					<p class="field enabled">
						<label for="notification_engine_enabled[#{notification_engine_rownum}]">Notifications Enabled</label>
						<input type="checkbox" name="notification_engine_enabled[#{notification_engine_rownum}]" id="notification_engine_enabled_#{notification_engine_rownum}" value="yes" checked="checked" rendered="#{configuration.notifications.getEnabledBooleanValue()}"/>
						<input type="checkbox" name="notification_engine_enabled[#{notification_engine_rownum}]" id="notification_engine_enabled_#{notification_engine_rownum}" value="yes" rendered="#{! configuration.notifications.getEnabledBooleanValue()}"/>
					</p>
					<p class="field notification_period">
						<label for="notification_engine_period[#{notification_engine_rownum}]">Notification Period</label>
						<select name="notification_engine_period[#{notification_engine_rownum}]" id="notification_engine_period_#{notification_engine_rownum}">
							<option value="">Not Specified</option>
							<data-set var="a_timeperiod" value="#{timeperiods}">
								<option rendered="#{notification_engine.notificationPeriod == a_timeperiod.name}" selected="selected" value="#{a_timeperiod.name}">#{coalesce(a_timeperiod.summary, a_timeperiod.name)}</option>
								<option rendered="#{notification_engine.notificationPeriod != a_timeperiod.name}" value="#{a_timeperiod.name}">#{coalesce(a_timeperiod.summary, a_timeperiod.name)}</option>
							</data-set>
						</select>
					</p>
					<p class="field on_alert">
						<label for="notification_engine_on_alert[#{notification_engine_rownum}]">Notify On Alerts</label>
						<input type="checkbox" name="notification_engine_on_alert[#{notification_engine_rownum}]" id="notification_engine_on_alert_#{notification_engine_rownum}" value="yes" checked="checked" rendered="#{notification_engine.getAlertsBooleanValue()}"/>
						<input type="checkbox" name="notification_engine_on_alert[#{notification_engine_rownum}]" id="notification_engine_on_alert_#{notification_engine_rownum}" value="yes" rendered="#{! notification_engine.getAlertsBooleanValue()}"/>
					</p>
					<p class="field on_recovery">
						<label for="notification_engine_on_recovery[#{notification_engine_rownum}]">Notify On Recovery</label>
						<input type="checkbox" name="notification_engine_on_recovery[#{notification_engine_rownum}]" id="notification_engine_on_recovery_#{notification_engine_rownum}" value="yes" checked="checked" rendered="#{notification_engine.getRecoveryBooleanValue()}"/>
						<input type="checkbox" name="notification_engine_on_recovery[#{notification_engine_rownum}]" id="notification_engine_on_recovery_#{notification_engine_rownum}" value="yes" rendered="#{! notification_engine.getRecoveryBooleanValue()}"/>
					</p>
					<p class="field ignore_pending">
						<label for="notification_engine_ignore_pending[#{notification_engine_rownum}]">Ignore Pending Notifications</label>
						<input type="checkbox" name="notification_engine_ignore_pending[#{notification_engine_rownum}]" id="notification_engine_ignore_pending_#{notification_engine_rownum}" value="yes" checked="checked" rendered="#{notification_engine.isIgnore('pending')}"/>
						<input type="checkbox" name="notification_engine_ignore_pending[#{notification_engine_rownum}]" id="notification_engine_ignore_pending_#{notification_engine_rownum}" value="yes" rendered="#{! notification_engine.isIgnore('pending')}"/>
					</p>
					<p class="field ignore_ok">
						<label for="notification_engine_ignore_ok[#{notification_engine_rownum}]">Ignore OK Notifications</label>
						<input type="checkbox" name="notification_engine_ignore_ok[#{notification_engine_rownum}]" id="notification_engine_ignore_ok_#{notification_engine_rownum}" value="yes" checked="checked" rendered="#{notification_engine.isIgnore('ok')}"/>
						<input type="checkbox" name="notification_engine_ignore_ok[#{notification_engine_rownum}]" id="notification_engine_ignore_ok_#{notification_engine_rownum}" value="yes" rendered="#{! notification_engine.isIgnore('ok')}"/>
					</p>
					<p class="field ignore_warning">
						<label for="notification_engine_ignore_warning[#{notification_engine_rownum}]">Ignore Warning Notifications</label>
						<input type="checkbox" name="notification_engine_ignore_warning[#{notification_engine_rownum}]" id="notification_engine_ignore_warning_#{notification_engine_rownum}" value="yes" checked="checked" rendered="#{notification_engine.isIgnore('warning')}"/>
						<input type="checkbox" name="notification_engine_ignore_warning[#{notification_engine_rownum}]" id="notification_engine_ignore_warning_#{notification_engine_rownum}" value="yes" rendered="#{! notification_engine.isIgnore('warning')}"/>
					</p>
					<p class="field ignore_critical">
						<label for="notification_engine_ignore_critical[#{notification_engine_rownum}]">Ignore Critical Notifications</label>
						<input type="checkbox" name="notification_engine_ignore_critical[#{notification_engine_rownum}]" id="notification_engine_ignore_critical_#{notification_engine_rownum}" value="yes" checked="checked" rendered="#{notification_engine.isIgnore('critical')}"/>
						<input type="checkbox" name="notification_engine_ignore_critical[#{notification_engine_rownum}]" id="notification_engine_ignore_critical_#{notification_engine_rownum}" value="yes" rendered="#{! notification_engine.isIgnore('critical')}"/>
					</p>
					<p class="field ignore_unknown">
						<label for="notification_engine_ignore_unknown[#{notification_engine_rownum}]">Ignore Unknown Notifications</label>
						<input type="checkbox" name="notification_engine_ignore_unknown[#{notification_engine_rownum}]" id="notification_engine_ignore_unknown_#{notification_engine_rownum}" value="yes" checked="checked" rendered="#{notification_engine.isIgnore('unknown')}"/>
						<input type="checkbox" name="notification_engine_ignore_unknown[#{notification_engine_rownum}]" id="notification_engine_ignore_unknown_#{notification_engine_rownum}" value="yes" rendered="#{! notification_engine.isIgnore('unknown')}"/>
					</p>
					<p class="field ignore_timeout">
						<label for="notification_engine_ignore_timeout[#{notification_engine_rownum}]">Ignore Timeout Notifications</label>
						<input type="checkbox" name="notification_engine_ignore_timeout[#{notification_engine_rownum}]" id="notification_engine_ignore_timeout_#{notification_engine_rownum}" value="yes" checked="checked" rendered="#{notification_engine.isIgnore('timeout')}"/>
						<input type="checkbox" name="notification_engine_ignore_timeout[#{notification_engine_rownum}]" id="notification_engine_ignore_timeout_#{notification_engine_rownum}" value="yes" rendered="#{! notification_engine.isIgnore('timeout')}"/>
					</p>
					<p class="field ignore_error">
						<label for="notification_engine_ignore_error[#{notification_engine_rownum}]">Ignore Error Notifications</label>
						<input type="checkbox" name="notification_engine_ignore_error[#{notification_engine_rownum}]" id="notification_engine_ignore_error_#{notification_engine_rownum}" value="yes" checked="checked" rendered="#{notification_engine.isIgnore('error')}"/>
						<input type="checkbox" name="notification_engine_ignore_error[#{notification_engine_rownum}]" id="notification_engine_ignore_error_#{notification_engine_rownum}" value="yes" rendered="#{! notification_engine.isIgnore('error')}"/>
					</p>
				</li>
			</data-set>
			<li id="add_notification_engine_row" style="padding: 0;">
				<div id="notification_engine_template" style="display: none;">
					<a href="#remove" class="remove">Remove</a>
					<p class="field engine">
                        <label for="">Notification Engine</label>
                        <input type="text" placeholder="email" id=""/>
                    </p>
                    <p class="field enabled">
                        <label for="">Notifications Enabled</label>
                        <input type="checkbox" value="yes" checked="checked"/>
                    </p>
                    <p class="field notification_period">
                        <label for="">Notification Period</label>
                        <select name="">
                            <option value="">Not Specified</option>
                            <data-set var="a_timeperiod" value="#{timeperiods}">
                                <option value="#{a_timeperiod.name}">#{coalesce(a_timeperiod.summary, a_timeperiod.name)}</option>
                            </data-set>
                        </select>
                    </p>
                    <p class="field on_alert">
                        <label for="">Notify On Alerts</label>
                        <input type="checkbox" value="yes" checked="checked"/>
                    </p>
                    <p class="field on_recovery">
                        <label for="">Notify On Recovery</label>
                        <input type="checkbox" value="yes" checked="checked"/>
                    </p>
                    <p class="field ignore_pending">
                        <label for="">Ignore Pending Notifications</label>
                        <input type="checkbox" value="yes"/>
                    </p>
                    <p class="field ignore_ok">
                        <label for="">Ignore OK Notifications</label>
                        <input type="checkbox" value="yes"/>
                    </p>
                    <p class="field ignore_warning">
                        <label for="">Ignore Warning Notifications</label>
                        <input type="checkbox" value="yes"/>
                    </p>
                    <p class="field ignore_critical">
                        <label for="">Ignore Critical Notifications</label>
                        <input type="checkbox" value="yes"/>
                    </p>
                    <p class="field ignore_unknown">
                        <label for="">Ignore Unknown Notifications</label>
                        <input type="checkbox" value="yes"/>
                    </p>
                    <p class="field ignore_timeout">
                        <label for="">Ignore Timeout Notifications</label>
                        <input type="checkbox" value="yes"/>
                    </p>
                    <p class="field ignore_error">
                        <label for="">Ignore Error Notifications</label>
                        <input type="checkbox" value="yes"/>
                    </p>
				</div>
				<a class="add" id="add_notification_engine" href="#add">Add Notification Engine</a>
			</li>
		</ul>
	</div>
	<script type="text/javascript">
		/* <![CDATA[ */
		(function() {
		
			function update_notification_engines() {
			 	var fields = [
			 		{ field: 'engine',              type: 'input',  id: 'notification_engine_engine' },
			 		{ field: 'enabled',             type: 'input',  id: 'notification_engine_enabled' },
			 		{ field: 'notification_period', type: 'select', id: 'notification_engine_period' },
			 		{ field: 'on_alert',            type: 'input',  id: 'notification_engine_on_alert' },
			 		{ field: 'on_recovery',         type: 'input',  id: 'notification_engine_on_recovery' },
			 		{ field: 'ignore_pending',      type: 'input',  id: 'notification_engine_ignore_pending' },
			 		{ field: 'ignore_ok',           type: 'input',  id: 'notification_engine_ignore_ok' },
			 		{ field: 'ignore_warning',      type: 'input',  id: 'notification_engine_ignore_warning' },
			 		{ field: 'ignore_critical',     type: 'input',  id: 'notification_engine_ignore_critical' },
			 		{ field: 'ignore_unknown',      type: 'input',  id: 'notification_engine_ignore_unknown' },
			 		{ field: 'ignore_timeout',      type: 'input',  id: 'notification_engine_ignore_timeout' },
			 		{ field: 'ignore_error',        type: 'input',  id: 'notification_engine_ignore_error' },
			 	];
			 	for (var j = 0; j < fields.length; j++)
			 	{
	                $('#notification_engines p.' + fields[j].field + ' ' + fields[j].type).each(function(i, e) {
	                	if ($(e).parent().parent().attr('id') != 'notification_engine_template') {
	                    	$(e).attr('id', fields[j].id + '_' + i);
	                    	$(e).attr('name', fields[j].id + '[' + i + ']');
	                    	$(e).siblings('label').attr('for', fields[j].id + '[' + i + ']')
	                    }
	                });
	            }   
            }
            
            function remove_notification_engine(ev) {
                ev.preventDefault();
                $(this).parent().remove();
                update_notification_engines();
            }
            
            function add_notification_engine(ev) {
                ev.preventDefault();
                // clone the template
                var fields = $('#notification_engine_template').children().clone();
                // containers
                var li = document.createElement('li');
                $(li).html(fields);
                // insert
                $('#add_notification_engine_row').before(li);
                // actions
                $(li).children('a.remove').click(remove_notification_engine);
                // update
                update_notification_engines();
            }
            
            $('#add_notification_engine').click(add_notification_engine);
            $('#notification_engines .remove').click(remove_notification_engine);
            
		})()
		/* ]]> */
	</script>
</fragment>