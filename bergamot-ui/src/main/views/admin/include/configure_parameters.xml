<!DOCTYPE balsa SYSTEM "http://balsa.intrbiz.net/balsa.dtd">
<?RenderLibrary com.intrbiz.balsa?>
<!-- The index view -->
<fragment xmlns="com.intrbiz.balsa">
	<div class="col12" style="margin-bottom: 20px;">
		<h2>Parameters</h2>
		<p class="text-body">
			
		</p>
		<div id="parameters">
			<ul>
				<data-set var="parameter" value="#{configuration.parameters}">
					<li>
						<a href="#remove" class="remove">Remove</a>
						<p class="field name">
							<label for="parameter_name[#{parameter_rownum}]">Name</label>
							<input type="text" name="parameter_name[#{parameter_rownum}]" id="parameter_name[#{parameter_rownum}]" value="#{parameter.name}"/>
						</p>
						<p class="field description">
							<label for="parameter_description[#{parameter_rownum}]">Description</label>
							<input type="text" name="parameter_description[#{parameter_rownum}]" id="parameter_description[#{parameter_rownum}]" value="#{coalesce(parameter.description, '')}"/>
						</p>
						<p class="field area value">
							<label for="parameter_value[#{parameter_rownum}]">Value</label>
							<textarea name="parameter_value[#{parameter_rownum}]" id="parameter_value[#{parameter_rownum}]">#{coalesce(parameter.valueOrText, '')}</textarea>
						</p>
					</li>
				</data-set>
				<li id="add_parameter_row">
					<p id="parameter_template_name" class="field name" style="display: none;">
						<label for="parameter_name[#{parameter_rownum}]">Name</label>
						<input type="text" id="parameter_template_name_input"/>
					</p>
					<p id="parameter_template_description" class="field description" style="display: none;">
						<label for="parameter_description[#{parameter_rownum}]">Description</label>
						<input type="text" id="parameter_template_description_input"/>
					</p>
					<p id="parameter_template_value" class="field area value" style="display: none;">
						<label for="parameter_value[#{parameter_rownum}]">Value</label>
						<textarea id="parameter_template_value_textarea"></textarea>
					</p>
                	<a class="add" id="add_parameter" href="#add">Add Parameter</a>
            	</li>
			</ul>
		</div>
	</div>
	<script type="text/javascript">
		(function() {
		
			function update_parameters() {
                $('#parameters p.name input[type=text]').each(function(i, e) {
                	if ($(e).attr('id') != 'parameter_template_name_input') {
                    	$(e).attr('id', 'parameter_name_' + i);
                    	$(e).attr('name', 'parameter_name[' + i + ']');
                    }
                });
                $('#parameters p.description input[type=text]').each(function(i, e) {
                	if ($(e).attr('id') != 'parameter_template_description_input') {
                    	$(e).attr('id', 'parameter_description_' + i);
                    	$(e).attr('name', 'parameter_description[' + i + ']');
                    }
                });
                $('#parameters p.value textarea').each(function(i, e) {
                	if ($(e).attr('id') != 'parameter_template_value_textarea') {
                    	$(e).attr('id', 'parameter_value_' + i);
                    	$(e).attr('name', 'parameter_value[' + i + ']');
                    }
                });
            }
            
            function remove_parameter(ev) {
                ev.preventDefault();
                $(this).parent().remove();
                update_parameters();
            }
            
            function add_parameter(ev) {
                ev.preventDefault();
                // remove
                var rm  = document.createElement('a');
                $(rm).attr('href', '#remove');
                $(rm).text('Remove');
                $(rm).attr('class', 'remove');
                // fields
                var fn = $('#parameter_template_name').clone();
                $(fn).attr('style', '');
                $(fn).attr('id', '');
                var fd = $('#parameter_template_description').clone();
                $(fd).attr('style', '');
                $(fd).attr('id', '');
                var fv = $('#parameter_template_value').clone();
                $(fv).attr('style', '');
                $(fv).attr('id', '');
                // containers
                var li = document.createElement('li');
                $(li).html([rm, fn, fd, fv]);
                // insert
                $('#add_parameter_row').before(li);
                // actions
                $(rm).click(remove_parameter);
                // update
                update_parameters();
            }
            
            $('#add_parameter').click(add_parameter);
            $('#parameters .remove').click(remove_parameter);
            
		})()
	</script>
</fragment>