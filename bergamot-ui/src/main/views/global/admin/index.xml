<!DOCTYPE balsa SYSTEM "http://balsa.intrbiz.net/balsa.dtd">
<?RenderLibrary com.intrbiz.balsa?>
<!-- The index view -->
<fragment xmlns="com.intrbiz.balsa" title="Global Admin">
	<div class="row submenu pull-right">
		<a href="/global/admin/utils/">Global System Utilities</a>
	</div>
    <div class="row" rendered="#{showDaemons and globalAdmin}">
		<h3>Global System Status</h3>
		<data-set var="daemon" value="#{daemons}">
			<div class="col3 dash_icon check">
				<h3>
					<span class="dash_img status_#{if(daemon.isAlive(),'ok', 'critical')}" title="Daemon #{if(daemon.isAlive(), 'is alive', 'has failed')}">
						<img src="#{public('/images/icons/64/bergamot.png')}" />
					</span>
					<span class="name">#{ucFirst(daemon.daemonName.replace('-', ' '))}</span>
					<span class="name">(#{ucFirst(coalesce(daemon.daemonKind, ''))})</span>
			    </h3>
			    <p>
				    <span class="label">Host: </span>
				    <span class="value">#{daemon.hostName}</span>
			    </p>				    
			    <p>
				    <span class="label">Started At: </span>
				    <span class="value">#{dateformat('HH:mm:ss', daemon.startedAt)} on #{dateformat('EEEE dd/MM/yyyy', daemon.startedAt)}</span>
			    </p>
			    <p>
				    <span class="label">Last Seen: </span>
				    <span class="value">#{dateformat('HH:mm:ss', daemon.lastHeartbeatTime)} on #{dateformat('EEEE dd/MM/yyyy', daemon.lastHeartbeatTime)}</span>
			    </p>
			    <p>
				    <span class="label">&nbsp;</span>
				    <span class="value">(#{daemon.getLastHeartbeatAge() / 1000} seconds ago)</span>
			    </p>
			    <p>
				    <span class="label">Instance Id:</span>
				    <span class="value" style="font-size: 13px;">#{daemon.instanceId}</span>
			    </p>
			    <p>
				    <span class="label">Runtime Id:</span>
				    <span class="value" style="font-size: 13px;">#{daemon.runtimeId}</span>
			    </p>
			</div>
		</data-set>
    </div>
    <div class="row" rendered="#{globalAdmin}">
		<h3>Sites</h3>
		<table>
			<tr>
				<th>Name</th>
				<th>Summary</th>
				<th>Pool Count</th>
				<th>Aliases</th>
				<th>Disabled</th>
				<th></th>
			</tr>
			<data-set var="site" value="#{sites}">
				<tr>
					<td><a href="https://#{site.name}/">#{site.name}</a></td>
					<td>#{site.summary}</td>
					<td>#{site.poolCount}</td>
					<td>#{site.aliases}</td>
					<td></td>
					<td>
						<!-- Disable -->
    					<form action="#{path('/global/admin/site/disable')}" method="post">
							<input type="hidden" name="id" value="#{site.id}"/>
							<input type="submit" name="disable" value="Disable" class="danger"/>
						</form>
						<!-- Delete -->
    					<form action="#{path('/global/admin/site/delete')}" method="post">
							<input type="hidden" name="id" value="#{site.id}"/>
							<input type="submit" name="delete" value="Delete" class="danger"/>
						</form>
					</td>
				</tr>
			</data-set>
		</table>
	</div>
</fragment>