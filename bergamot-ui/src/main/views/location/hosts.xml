<!DOCTYPE balsa SYSTEM "http://balsa.intrbiz.net/balsa.dtd">
<?RenderLibrary com.intrbiz.balsa?>
<!-- The index view -->
<fragment xmlns="com.intrbiz.balsa" title="Location #{location.summary}">
	<div class="row">
		<data-set var="location" value="#{locations}">
			<include view="include/location"/>
		</data-set>
	</div>
	
	<container rendered="#{! isempty(hosts)}">
	
		<div class="row submenu pull-right">
			<a href="/location/execute-all-hosts/#{group.id}" id="check-all-now" data-location-id="#{location.id}">Check all now</a>
		</div>
	
		<div class="row">
			<data-set var="check" value="#{hosts}">
				<include view="include/check"/>
			</data-set>
		</div>
	
	</container>
	
	<script type="text/javascript">
		require(["bergamot/lib/util/console-log", "bergamot/lib/ui/check-state", "bergamot/lib/data/api-driver"], function(bergamot_console_log, bergamot_ui_server_state, bergamot_api_driver)
		{
		    bergamot_console_log.attachTo(document);

		    bergamot_ui_server_state.attachTo("div.check");

		    bergamot_api_driver.attachTo(document, {
				url: #{'"' + bergamot_update_url() + '"'},
		    });
		});
		
		// execute all hosts
		$(document).ready(function() {
			$('#check-all-now').click(function(ev) {
				ev.preventDefault();
				var id = $(this).attr("data-location-id");
				$.getJSON('/api/location/id/' + id + '/execute-all-hosts', function(data) { /* all ok */ });
			});
		});
	</script>
	
</fragment>