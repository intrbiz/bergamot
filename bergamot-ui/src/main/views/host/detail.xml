<!DOCTYPE balsa SYSTEM "http://balsa.intrbiz.net/balsa.dtd">
<?RenderLibrary com.intrbiz.balsa?>
<!-- The index view -->
<fragment xmlns="com.intrbiz.balsa" title="Host #{host.summary}">

	<div class="row submenu pull-right">
		<a rendered="#{host.suppressed}"  href="/host/unsuppress/#{host.id}">Unsupress</a>
		<a rendered="#{!host.suppressed}" href="/host/suppress/#{host.id}">Supress</a>
		<a rendered="#{host.enabled}"     href="/host/disable/#{host.id}">Disable</a>
		<a rendered="#{!host.enabled}"    href="/host/enable/#{host.id}">Enable</a>
		<a href="/host/execute/#{host.id}">Check now</a>
	</div>

	<div class="row">
		<div class="col4 dash_icon check" data-check-id="#{host.id}">
		    <h3>
				<span class="dash_img #{host.state.status.toString().toLowerCase()}" title="The check is #{host.state.status.toString().toLowerCase()}">
					<img src="/host-icon.png" />
				</span>
				<span class="name">#{host.summary}</span>
		    </h3>
		    <p class="field-host">
		    	<span class="label wide">Host name: </span>
		   		<span class="value">#{host.name}</span>
	    	</p>
	    	<p class="field-address">
		    	<span class="label wide">Address: </span>
		   		<span class="value">#{host.address}</span>
	    	</p>
	    	<p class="field-status">
			    <span class="label wide">Status: </span>
			    <span class="value">#{host.state.status.toString().substring(0,1) + host.state.status.toString().substring(1).toLowerCase()}</span>
		    </p>
	    	<p class="field-attempt">
			    <span class="label wide">Attempt: </span>
			    <span class="value">
			    	<span>#{host.state.attempt} of #{host.currentAttemptThreshold}</span>
			    	<span class="info" rendered="#{host.state.transitioning}" title="The check is changing state">Changing</span>
			    	<span class="info" rendered="#{host.state.hard}" title="The check is in a steady state">Steady</span>
			    </span>
		    </p>
	    	<p>
			    <span class="label wide">Suppressed: </span>
			    <span class="value">#{if(host.suppressed, 'yes', 'no')}</span>
		    </p>
		    <p>
			    <span class="label wide">Enabled: </span>
			    <span class="value">#{if(host.enabled, 'yes', 'no')}</span>
		    </p>
		    <p class="field-last-checked">
			    <span class="label wide">Last checked: </span>
			    <span class="value">#{dateformat('HH:mm:ss', host.state.lastCheckTime)} on #{dateformat('EEEE dd/MM/yyyy', host.state.lastCheckTime)}</span>
		    </p>
		    <p class="field-last-state-change">
			    <span class="label wide">Last state change: </span>
			    <span class="value">#{dateformat('HH:mm:ss', host.state.lastStateChange)} on #{dateformat('EEEE dd/MM/yyyy', host.state.lastStateChange)}</span>
		    </p>
		    <p class="field-last-status">
			    <span class="label wide">Last status: </span>
			    <span class="value">#{host.state.lastHardStatus.toString().substring(0,1) + host.state.lastHardStatus.toString().substring(1).toLowerCase()}</span>
		    </p>
		    <p class="output field-output">
			    <span class="label wide">Output: </span>
			    <span class="value">#{coalesce(host.state.output, '')}</span>
		    </p>
		</div>
	</div>
	
	<!-- Services -->
	
	<h2 rendered="#{! host.services.isEmpty()}">Services</h2>
	
	<div class="row submenu pull-right" rendered="#{! host.services.isEmpty()}">
		<a href="/host/execute-services/#{host.id}">Check all services now</a>
	</div>

	<div class="row hostgroup services" rendered="#{! host.services.isEmpty()}">
		<data-set var="check" value="#{host.services}">
			<include view="include/check"/>
		</data-set>
	</div>
	
	<!-- Traps -->
	
	<h2 rendered="#{! host.traps.isEmpty()}">Traps</h2>

	<div class="row hostgroup services" rendered="#{! host.traps.isEmpty()}">
		<data-set var="check" value="#{host.traps}">
			<include view="include/check"/>
		</data-set>
	</div>
	
	<!-- Configuration -->
	
	<h2>Configuration</h2>
		
	<div class="row">
		<div class="col4 dash_icon">
		    <h3>Contact</h3>
			<data-set var="contact" value="#{host.allContacts}">
				<p>
					<span class="label">#{contact.summary}</span>
					<span class="value">&nbsp;</span>
				</p>
			</data-set>
		</div>
		<div class="col4 dash_icon">
			<h3>Scheduling</h3>
			<p>
				<span class="label wide">Check period</span>
				<span class="value">#{host.timePeriod.summary}</span>
			</p>
			<p>
				<span class="label wide">Check interval</span>
				<span class="value">#{host.checkInterval / 1000}s</span>
			</p>
			<p>
				<span class="label wide">Retry interval</span>
				<span class="value">#{host.retryInterval / 1000}s</span>
			</p>
		</div>
		<div class="col4 dash_icon">
			<h3>Notifications</h3>
			<p>
				<span class="label wide">Notifications enabled</span>
				<span class="value">#{if(host.notifications.enabled, 'yes', 'no')}</span>
			</p>
			<p>
				<span class="label wide">Notification period</span>
				<span class="value">#{coalesce(host.notifications.timePeriod.summary, 'Not configured')}</span>
			</p>
		</div>
	</div>
	
	<div class="row">
		<div class="col4 dash_icon">
			<h3>Statistics</h3>
			<p>
				<span class="label wide">Last runtime: </span>
				<span class="value">#{host.stats.lastRuntime} ms</span>
			</p>
			<p>
				<span class="label wide">Average runtime: </span>
				<span class="value">#{host.stats.averageRuntime} ms</span>
			</p>
			<p>
				<span class="label wide">Last processing latency: </span>
				<span class="value">#{host.stats.lastCheckProcessingLatency} ms</span>
			</p>
			<p>
				<span class="label wide">Average processing latency: </span>
				<span class="value">#{host.stats.averageCheckProcessingLatency} ms</span>
			</p>
			<p>
				<span class="label wide">Last execution latency: </span>
				<span class="value">#{host.stats.lastCheckExecutionLatency} ms</span>
			</p>
			<p>
				<span class="label wide">Average execution latency: </span>
				<span class="value">#{host.stats.averageCheckExecutionLatency} ms</span>
			</p>
		</div>
		<div class="col4 dash_icon">
			<h3>Command</h3>
			<p>
				<span class="label wide">Command Engine: </span>
				<span class="value">#{host.checkCommand.command.engine}</span>
			</p>
			<p>
				<span class="label wide">Command Name: </span>
				<span class="value">#{host.checkCommand.command.name}</span>
			</p>
			<p>
				<span class="label wide">Parameters:</span>
				<span class="value">&nbsp;</span>
			</p>
			<data-set var="parameter" value="#{host.checkCommand.resolveCheckParameters()}">
				<p>
					<span class="label wide indent">#{parameter.name}: </span>
					<span class="value">#{parameter.value}</span>
				</p>
			</data-set>
		</div>
	</div>
	
	<div class="row">
		<div class="col12">
			<h3>XML</h3>
			<pre>#{host.configuration.toString()}</pre>
		</div>
	</div>
	
	<script type="text/javascript">
		require(["bergamot/lib/util/console-log", "bergamot/lib/ui/check-state", "bergamot/lib/data/api-driver"], function(bergamot_console_log, bergamot_ui_server_state, bergamot_api_driver)
		{
		    bergamot_console_log.attachTo(document);

		    bergamot_ui_server_state.attachTo("div.check");

		    bergamot_api_driver.attachTo(document, {
				url: "ws://127.0.0.1:8081/websocket",
		    });
		});
	</script>

</fragment>