{
  "type" : "bergamot.send_update",
  "id" : "a9f82618-9801-4b91-8bed-9c8c01f883ad",
  "raised" : 1511362831737,
  "to" : [ {
    "type" : "bergamot.contact",
    "id" : "2979259f-9599-48a5-9678-383664fffa9b",
    "site_id" : "2979259f-9599-4000-8000-000000000000",
    "name" : "dataplatform.slack",
    "summary" : "Data Platform Slack",
    "description" : "Dummy contact for dataplatform alerts which are sent to slack, Bergamot requires at least one contact to notify for a notification to be sent.",
    "parameters" : [ ],
    "security_domains" : [ ],
    "email" : "chris.ellis+dataplatformslack@hivehome.com",
    "pager" : null,
    "mobile" : null,
    "phone" : null,
    "engines" : [ "slack", "sms", "email" ],
    "teams" : [ {
      "type" : "bergamot.team",
      "id" : "2979259f-9599-433c-9ed0-1db3591e68e3",
      "site_id" : "2979259f-9599-4000-8000-000000000000",
      "name" : "dataplatform-ops",
      "summary" : "Data Platform Operators",
      "description" : null,
      "parameters" : [ {
        "type" : "bergamot.parameter",
        "name" : "slack.url.me-prod-alerts",
        "description" : "The",
        "value" : "https://hooks.slack.com/services/T1MC788GJ/B4SRRJN9F/agsadgdsadsadsdsd##test"
      } ],
      "security_domains" : [ ],
      "teams" : [ ],
      "children" : [ ],
      "contacts" : [ ],
      "granted-permissions" : [ ],
      "revoked-permissions" : [ ]
    } ],
    "notifications" : {
      "type" : "bergamot.notifications",
      "enabled" : true,
      "time_period" : {
        "type" : "bergamot.time_period",
        "id" : "2979259f-9599-42fa-bd90-48709ca1d38c",
        "site_id" : "2979259f-9599-4000-8000-000000000000",
        "name" : "24x7",
        "summary" : "24x7",
        "description" : "24 hours a day, seven days a week",
        "parameters" : [ ],
        "security_domains" : [ null ],
        "excludes" : [ ],
        "ranges" : [ ]
      },
      "engines" : [ {
        "type" : "bergamot.notification_engine",
        "enabled" : true,
        "time_period" : {
          "type" : "bergamot.time_period",
          "id" : "2979259f-9599-42fa-bd90-48709ca1d38c",
          "site_id" : "2979259f-9599-4000-8000-000000000000",
          "name" : "24x7",
          "summary" : "24x7",
          "description" : "24 hours a day, seven days a week",
          "parameters" : [ ],
          "security_domains" : [ null ],
          "excludes" : [ ],
          "ranges" : [ ]
        },
        "engine" : "email",
        "alerts_enabled" : true,
        "recovery_enabled" : true,
        "ignore" : [ ],
        "acknowledge_enabled" : true,
        "updates_enabled" : true
      }, {
        "type" : "bergamot.notification_engine",
        "enabled" : true,
        "time_period" : {
          "type" : "bergamot.time_period",
          "id" : "2979259f-9599-42fa-bd90-48709ca1d38c",
          "site_id" : "2979259f-9599-4000-8000-000000000000",
          "name" : "24x7",
          "summary" : "24x7",
          "description" : "24 hours a day, seven days a week",
          "parameters" : [ ],
          "security_domains" : [ null ],
          "excludes" : [ ],
          "ranges" : [ ]
        },
        "engine" : "slack",
        "alerts_enabled" : true,
        "recovery_enabled" : true,
        "ignore" : [ ],
        "acknowledge_enabled" : true,
        "updates_enabled" : true
      }, {
        "type" : "bergamot.notification_engine",
        "enabled" : true,
        "time_period" : {
          "type" : "bergamot.time_period",
          "id" : "2979259f-9599-42fa-bd90-48709ca1d38c",
          "site_id" : "2979259f-9599-4000-8000-000000000000",
          "name" : "24x7",
          "summary" : "24x7",
          "description" : "24 hours a day, seven days a week",
          "parameters" : [ ],
          "security_domains" : [ null ],
          "excludes" : [ ],
          "ranges" : [ ]
        },
        "engine" : "sms",
        "alerts_enabled" : true,
        "recovery_enabled" : false,
        "ignore" : [ "PENDING", "OK", "WARNING" ],
        "acknowledge_enabled" : true,
        "updates_enabled" : true
      } ],
      "alerts_enabled" : true,
      "recovery_enabled" : true,
      "ignore" : [ ],
      "all_engines_enabled" : true,
      "acknowledge_enabled" : true,
      "escalations" : [ {
        "type" : "bergamot.escalation",
        "after" : 21600000,
        "time_period" : null,
        "ignore" : [ "WARNING" ],
        "contacts" : [ ],
        "teams" : [ {
          "type" : "bergamot.team",
          "id" : "2979259f-9599-4b9f-bf12-169a2507b2a6",
          "site_id" : "2979259f-9599-4000-8000-000000000000",
          "name" : "test-managers",
          "summary" : "Test Managers",
          "description" : null,
          "parameters" : [ ],
          "security_domains" : [ ],
          "teams" : [ ],
          "children" : [ ],
          "contacts" : [ ],
          "granted-permissions" : [ ],
          "revoked-permissions" : [ ]
        } ],
        "renotify" : false
      }, {
        "type" : "bergamot.escalation",
        "after" : 3600000,
        "time_period" : null,
        "ignore" : [ "WARNING" ],
        "contacts" : [ ],
        "teams" : [ {
          "type" : "bergamot.team",
          "id" : "2979259f-9599-4b9f-bf12-169a2507b2a6",
          "site_id" : "2979259f-9599-4000-8000-000000000000",
          "name" : "test-managers",
          "summary" : "Test Managers",
          "description" : null,
          "parameters" : [ ],
          "security_domains" : [ ],
          "teams" : [ ],
          "children" : [ ],
          "contacts" : [ ],
          "granted-permissions" : [ ],
          "revoked-permissions" : [ ]
        } ],
        "renotify" : false
      }, {
        "type" : "bergamot.escalation",
        "after" : 1800000,
        "time_period" : null,
        "ignore" : [ ],
        "contacts" : [ ],
        "teams" : [ ],
        "renotify" : true
      } ],
      "updates_enabled" : true,
      "updates_time_period" : {
        "type" : "bergamot.time_period",
        "id" : "2979259f-9599-42fa-bd90-48709ca1d38c",
        "site_id" : "2979259f-9599-4000-8000-000000000000",
        "name" : "24x7",
        "summary" : "24x7",
        "description" : "24 hours a day, seven days a week",
        "parameters" : [ ],
        "security_domains" : [ null ],
        "excludes" : [ ],
        "ranges" : [ ]
      },
      "updates_ignore" : [ ]
    },
    "granted-permissions" : [ ],
    "revoked-permissions" : [ ]
  } ],
  "site" : {
    "type" : "bergamot.site",
    "id" : "2979259f-9599-4000-8000-000000000000",
    "name" : "monitoring.core.test.test.info",
    "summary" : "Bergamot Monitoring",
    "description" : null,
    "aliases" : [ ],
    "pool_count" : 0
  },
  "check" : {
    "type" : "bergamot.service",
    "id" : "2979259f-9599-4b58-9c52-f8ef2bfc73b9",
    "site_id" : "2979259f-9599-4000-8000-000000000000",
    "name" : "me-reads-extracts-status",
    "summary" : "ME Reads Extract Status",
    "description" : "A generic service template",
    "parameters" : [ {
      "type" : "bergamot.parameter",
      "name" : "slack.url.me-prod-alerts",
      "description" : "The",
      "value" : "https://hooks.slack.com/services/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##test_berga"
    } ],
    "security_domains" : [ null ],
    "state" : {
      "type" : "bergamot.state.check",
      "ok" : false,
      "status" : "CRITICAL",
      "output" : "Reads Not Loaded, Extract Pending",
      "last_check_time" : 1511362831686,
      "last_check_id" : null,
      "attempt" : 1,
      "hard" : true,
      "transitioning" : false,
      "flapping" : false,
      "last_state_change" : 1511362831700,
      "last_hard_ok" : true,
      "last_hard_status" : "OK",
      "last_hard_output" : "Reads Extract (D-1) Pending",
      "in_downtime" : false,
      "suppressed" : false,
      "acknowledged" : false,
      "encompassed" : false,
      "current_alert" : "2979259f-9599-4a98-a3df-d926af958f9a"
    },
    "suppressed" : false,
    "enabled" : true,
    "in_downtime" : false,
    "groups" : [ {
      "type" : "bergamot.group",
      "id" : "2979259f-9599-4f53-8cb5-364a45948205",
      "site_id" : "2979259f-9599-4000-8000-000000000000",
      "name" : "test-prod-pg-services",
      "summary" : "Prod PostgreSQL Services",
      "description" : null,
      "parameters" : [ ],
      "security_domains" : [ null ],
      "state" : {
        "type" : "bergamot.state.group",
        "ok" : false,
        "status" : "CRITICAL",
        "pending_count" : 0,
        "ok_count" : 15,
        "warning_count" : 0,
        "critical_count" : 1,
        "unknown_count" : 0,
        "timeout_count" : 0,
        "error_count" : 0,
        "suppressed_count" : 0,
        "info_count" : 6,
        "action_count" : 0,
        "in_downtime_count" : 0,
        "total_checks" : 22,
        "disconnected_count" : 0,
        "acknowledged_count" : 0,
        "encompassed_count" : 0
      },
      "groups" : [ ],
      "children" : [ ],
      "checks" : [ ]
    } ],
    "referenced_by" : [ ],
    "contacts" : [ ],
    "teams" : [ {
      "type" : "bergamot.team",
      "id" : "2979259f-9599-433c-9ed0-1db3591e68e3",
      "site_id" : "2979259f-9599-4000-8000-000000000000",
      "name" : "dataplatform-ops",
      "summary" : "Data Platform Operators",
      "description" : null,
      "parameters" : [ {
        "type" : "bergamot.parameter",
        "name" : "slack.url.me-prod-alerts",
        "description" : "The",
        "value" : "https://hooks.slack.com/services/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##dp-me-communication"
      } ],
      "security_domains" : [ ],
      "teams" : [ ],
      "children" : [ ],
      "contacts" : [ ],
      "granted-permissions" : [ ],
      "revoked-permissions" : [ ]
    } ],
    "notifications" : {
      "type" : "bergamot.notifications",
      "enabled" : true,
      "time_period" : {
        "type" : "bergamot.time_period",
        "id" : "2979259f-9599-42fa-bd90-48709ca1d38c",
        "site_id" : "2979259f-9599-4000-8000-000000000000",
        "name" : "24x7",
        "summary" : "24x7",
        "description" : "24 hours a day, seven days a week",
        "parameters" : [ ],
        "security_domains" : [ null ],
        "excludes" : [ ],
        "ranges" : [ ]
      },
      "engines" : [ ],
      "alerts_enabled" : true,
      "recovery_enabled" : true,
      "ignore" : [ ],
      "all_engines_enabled" : true,
      "acknowledge_enabled" : true,
      "escalations" : [ {
        "type" : "bergamot.escalation",
        "after" : 14400000,
        "time_period" : null,
        "ignore" : [ "WARNING" ],
        "contacts" : [ ],
        "teams" : [ {
          "type" : "bergamot.team",
          "id" : "2979259f-9599-4b9f-bf12-169a2507b2a6",
          "site_id" : "2979259f-9599-4000-8000-000000000000",
          "name" : "test-managers",
          "summary" : "Test Managers",
          "description" : null,
          "parameters" : [ ],
          "security_domains" : [ ],
          "teams" : [ ],
          "children" : [ ],
          "contacts" : [ ],
          "granted-permissions" : [ ],
          "revoked-permissions" : [ ]
        } ],
        "renotify" : false
      }, {
        "type" : "bergamot.escalation",
        "after" : 3600000,
        "time_period" : null,
        "ignore" : [ "WARNING" ],
        "contacts" : [ ],
        "teams" : [ {
          "type" : "bergamot.team",
          "id" : "2979259f-9599-4a39-a89b-e87b8b195249",
          "site_id" : "2979259f-9599-4000-8000-000000000000",
          "name" : "test-admins",
          "summary" : "Test Administrators",
          "description" : null,
          "parameters" : [ {
            "type" : "bergamot.parameter",
            "name" : "slack.url.me-prod-alerts",
            "description" : "The",
            "value" : "https://hooks.slack.com/services/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##ei-alerts"
          } ],
          "security_domains" : [ ],
          "teams" : [ ],
          "children" : [ ],
          "contacts" : [ ],
          "granted-permissions" : [ ],
          "revoked-permissions" : [ ]
        } ],
        "renotify" : false
      } ],
      "updates_enabled" : true,
      "updates_time_period" : {
        "type" : "bergamot.time_period",
        "id" : "2979259f-9599-4601-85ff-791bcc394318",
        "site_id" : "2979259f-9599-4000-8000-000000000000",
        "name" : "reads-extract-updates-period",
        "summary" : "Reads Extract Updates Period",
        "description" : null,
        "parameters" : [ ],
        "security_domains" : [ ],
        "excludes" : [ ],
        "ranges" : [ ]
      },
      "updates_ignore" : [ ]
    },
    "pool" : 1,
    "external-ref" : null,
    "note" : null,
    "downtime" : [ ],
    "comments" : [ ],
    "slas" : [ ],
    "alert_attempt_threshold" : 1,
    "recovery_attempt_threshold" : 1,
    "current_attempt_threshold" : 1,
    "check_command" : {
      "type" : "bergamot.command",
      "id" : null,
      "site_id" : null,
      "name" : null,
      "summary" : null,
      "description" : null,
      "parameters" : [ {
        "type" : "bergamot.parameter",
        "name" : "database",
        "description" : null,
        "value" : "test"
      }, {
        "type" : "bergamot.parameter",
        "name" : "warning",
        "description" : null,
        "value" : "1"
      }, {
        "type" : "bergamot.parameter",
        "name" : "critical",
        "description" : null,
        "value" : "1"
      }, {
        "type" : "bergamot.parameter",
        "name" : "username",
        "description" : null,
        "value" : "#{credential.test_prod_postgresql_monitoring.username}"
      }, {
        "type" : "bergamot.parameter",
        "name" : "password",
        "description" : null,
        "value" : "#{credential.test_prod_postgresql_monitoring.password}"
      } ],
      "command" : {
        "type" : "bergamot.command",
        "id" : "2979259f-9599-4965-858d-a876eee88463",
        "site_id" : "2979259f-9599-4000-8000-000000000000",
        "name" : "me_reads_extracts_status",
        "summary" : "Test Reads Extract Checks",
        "description" : "Test Reads Extract Checks",
        "parameters" : [ {
          "type" : "bergamot.parameter",
          "name" : "host",
          "description" : null,
          "value" : "#{host.address}"
        }, {
          "type" : "bergamot.parameter",
          "name" : "port",
          "description" : null,
          "value" : "5432"
        }, {
          "type" : "bergamot.parameter",
          "name" : "database",
          "description" : null,
          "value" : "postgres"
        }, {
          "type" : "bergamot.parameter",
          "name" : "username",
          "description" : null,
          "value" : "monitor"
        }, {
          "type" : "bergamot.parameter",
          "name" : "password",
          "description" : null,
          "value" : "monitor"
        }, {
          "type" : "bergamot.parameter",
          "name" : "ui-icon",
          "description" : "UI Icon",
          "value" : "/images/icons/64/storage.png"
        } ],
        "security_domains" : [ null ],
        "engine" : "jdbc",
        "executor" : null,
        "category" : null,
        "application" : "PostgreSQL",
        "script" : "\n        \n            /* Validate parameters */\n            bergamot.require('host');\n            bergamot.require('port');\n            bergamot.require('database');\n            bergamot.require('username');\n            bergamot.require('password');\n            /* URL */\n            var url = 'jdbc:postgresql://' + check.getParameter('host') + ':' + check.getIntParameter('port') + '/' + check.getParameter('database');\n            var user = check.getParameter('username');\n            var pass = check.getParameter('password');\n            /* Execute */\n            jdbc.connect(url, user, pass, function(con) {\n                con.query('SELECT monitoring.get_reads_extract_status()', function(rs) {\n                    // get our data\n                    rs.next();\n                    var statusCode   = rs.getLong(1);\n                    if (statusCode == 2) {\n                        bergamot.critical(\"Reads Not Loaded, Extract Pending\");\n                    }\n                    else if (statusCode == 1) {\n                        bergamot.warning(\"Reads Loaded But Extract Not Started\"); \n                    }\n                    else {\n                        bergamot.ok(\"Reads Extract (D-1) Pending\");\n                    }\n                });\n            });\n        \n        "
      },
      "script" : null
    },
    "stats" : {
      "type" : "bergamot.stats.check",
      "last_runtime" : 61.0,
      "average_runtime" : 34.36952379443483,
      "last_check_execution_latency" : 134.0,
      "average_check_execution_latency" : 110.05267668789094,
      "last_check_processing_latency" : 135.0,
      "average_check_processing_latency" : 111.42377316553109
    },
    "depends" : [ {
      "type" : "bergamot.host",
      "id" : "2979259f-9599-450d-aba2-f68a6bd911c4",
      "site_id" : "2979259f-9599-4000-8000-000000000000",
      "name" : "rw.postgresql.prod",
      "summary" : "Prod PostgreSQL Master",
      "description" : "Base PostgreSQL master",
      "parameters" : [ ],
      "security_domains" : [ ],
      "state" : {
        "type" : "bergamot.state.check",
        "ok" : true,
        "status" : "OK",
        "output" : "TCP OK - 0.001 second response time on rw.postgresql.prod.core.test.test.info port 5432",
        "last_check_time" : 1511362831615,
        "last_check_id" : null,
        "attempt" : 10,
        "hard" : true,
        "transitioning" : false,
        "flapping" : false,
        "last_state_change" : 1510293964928,
        "last_hard_ok" : true,
        "last_hard_status" : "OK",
        "last_hard_output" : "TCP OK - 0.001 second response time on rw.postgresql.prod.core.test.test.info port 5432",
        "in_downtime" : false,
        "suppressed" : false,
        "acknowledged" : false,
        "encompassed" : false,
        "current_alert" : null
      },
      "suppressed" : false,
      "enabled" : true,
      "in_downtime" : false,
      "groups" : [ ],
      "referenced_by" : [ ],
      "contacts" : [ ],
      "teams" : [ ],
      "notifications" : null,
      "pool" : 0,
      "external-ref" : null,
      "note" : null,
      "downtime" : [ ],
      "comments" : [ ],
      "slas" : [ ],
      "alert_attempt_threshold" : 5,
      "recovery_attempt_threshold" : 10,
      "current_attempt_threshold" : 10,
      "check_command" : null,
      "stats" : null,
      "depends" : [ ],
      "resource_pool" : null,
      "check_interval" : 30000,
      "retry_interval" : 30000,
      "current_interval" : 30000,
      "time_period" : {
        "type" : "bergamot.time_period",
        "id" : "2979259f-9599-42fa-bd90-48709ca1d38c",
        "site_id" : "2979259f-9599-4000-8000-000000000000",
        "name" : "24x7",
        "summary" : "24x7",
        "description" : "24 hours a day, seven days a week",
        "parameters" : [ ],
        "security_domains" : [ null ],
        "excludes" : [ ],
        "ranges" : [ ]
      },
      "address" : "rw.postgresql.prod.core.test.test.info",
      "location" : null,
      "services" : [ ],
      "traps" : [ ]
    } ],
    "resource_pool" : null,
    "check_interval" : 300000,
    "retry_interval" : 300000,
    "current_interval" : 300000,
    "time_period" : {
      "type" : "bergamot.time_period",
      "id" : "2979259f-9599-4d47-9d44-85908cebaf39",
      "site_id" : "2979259f-9599-4000-8000-000000000000",
      "name" : "1500to2400",
      "summary" : "15:00 to 24:00 every day",
      "description" : null,
      "parameters" : [ ],
      "security_domains" : [ ],
      "excludes" : [ ],
      "ranges" : [ ]
    },
    "host" : {
      "type" : "bergamot.host",
      "id" : "2979259f-9599-450d-aba2-f68a6bd911c4",
      "site_id" : "2979259f-9599-4000-8000-000000000000",
      "name" : "rw.postgresql.prod",
      "summary" : "Prod PostgreSQL Master",
      "description" : "Base PostgreSQL master",
      "parameters" : [ ],
      "security_domains" : [ ],
      "state" : {
        "type" : "bergamot.state.check",
        "ok" : true,
        "status" : "OK",
        "output" : "TCP OK - 0.001 second response time on rw.postgresql.prod.core.test.test.info port 5432",
        "last_check_time" : 1511362831615,
        "last_check_id" : null,
        "attempt" : 10,
        "hard" : true,
        "transitioning" : false,
        "flapping" : false,
        "last_state_change" : 1510293964928,
        "last_hard_ok" : true,
        "last_hard_status" : "OK",
        "last_hard_output" : "TCP OK - 0.001 second response time on rw.postgresql.prod.core.test.test.info port 5432",
        "in_downtime" : false,
        "suppressed" : false,
        "acknowledged" : false,
        "encompassed" : false,
        "current_alert" : null
      },
      "suppressed" : false,
      "enabled" : true,
      "in_downtime" : false,
      "groups" : [ ],
      "referenced_by" : [ ],
      "contacts" : [ ],
      "teams" : [ ],
      "notifications" : null,
      "pool" : 0,
      "external-ref" : null,
      "note" : null,
      "downtime" : [ ],
      "comments" : [ ],
      "slas" : [ ],
      "alert_attempt_threshold" : 5,
      "recovery_attempt_threshold" : 10,
      "current_attempt_threshold" : 10,
      "check_command" : null,
      "stats" : null,
      "depends" : [ ],
      "resource_pool" : null,
      "check_interval" : 30000,
      "retry_interval" : 30000,
      "current_interval" : 30000,
      "time_period" : {
        "type" : "bergamot.time_period",
        "id" : "2979259f-9599-42fa-bd90-48709ca1d38c",
        "site_id" : "2979259f-9599-4000-8000-000000000000",
        "name" : "24x7",
        "summary" : "24x7",
        "description" : "24 hours a day, seven days a week",
        "parameters" : [ ],
        "security_domains" : [ null ],
        "excludes" : [ ],
        "ranges" : [ ]
      },
      "address" : "rw.postgresql.prod.core.test.test.info",
      "location" : null,
      "services" : [ ],
      "traps" : [ ]
    },
    "category" : null,
    "application" : "PostgreSQL"
  },
  "alert_id" : null
}
