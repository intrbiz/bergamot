<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<bergamot site="bergamot.local">
    
    <command category="System" engine="snmp" name="check_snmp_description" extends="snmp_get_check">
        <summary>Get SNMP Description</summary>
        <parameter name="oid">1.3.6.1.2.1.1.1.0</parameter>
        <parameter description="UI Icon" name="ui-icon">/images/icons/64/info.png</parameter>
        <description>Get the device description of an SNMP device</description>
    </command>
    
    <command category="System" engine="snmp" name="check_snmp_contact" extends="snmp_get_check">
        <summary>Get SNMP Contact</summary>
        <parameter name="oid">1.3.6.1.2.1.1.4.0</parameter>
        <parameter description="UI Icon" name="ui-icon">/images/icons/64/info.png</parameter>
        <description>Get the contact of an SNMP device</description>
    </command>
    
    <command category="System" engine="snmp" name="check_snmp_name" extends="snmp_get_check">
        <summary>Get SNMP Name</summary>
        <parameter name="oid">1.3.6.1.2.1.1.5.0</parameter>
        <parameter description="UI Icon" name="ui-icon">/images/icons/64/info.png</parameter>
        <description>Get the name of an SNMP device</description>
    </command>
    
    <command category="System" engine="snmp" name="check_snmp_location" extends="snmp_get_check">
        <summary>Get SNMP Location</summary>
        <parameter name="oid">1.3.6.1.2.1.1.6.0</parameter>
        <parameter description="UI Icon" name="ui-icon">/images/icons/64/info.png</parameter>
        <description>Get the location of an SNMP device</description>
    </command>
    
    <command category="System" engine="snmp" name="check_snmp_uptime" extends="snmp_check">
        <parameter description="Warning if uptime is less than" name="warning">30</parameter>
        <parameter description="Critical if uptime is less than" name="critical">15</parameter>
        <script>
            <![CDATA[
            /* Validate parameters */
            bergamot.require('warning');
            bergamot.require('critical');
            /* Get the system uptime */
            agent.getValue(
                '1.3.6.1.2.1.1.3.0', 
                function(varbind) { 
                    if (varbind.getTimeTicksValue().getTicksMillis() < (bergamot.check.getParameter('critical') * 60 * 1000))
                    {
                        bergamot.critical('Up ' + varbind.getTimeTicksValue().toInterval());
                    }
                    else if (varbind.getTimeTicksValue().getTicksMillis() < (bergamot.check.getParameter('warning') * 60 * 1000))
                    {
                        bergamot.warning('Up ' + varbind.getTimeTicksValue().toInterval());
                    }
                    else
                    {
                        bergamot.ok('Up ' + varbind.getTimeTicksValue().toInterval());
                    }
                },
                function(exception) {
                    bergamot.error(exception);
                }
            );
            ]]>
        </script>
        <parameter description="UI Icon" name="ui-icon">/images/icons/64/time.png</parameter>
        <description>Check the uptime of an SNMP device, raising an alert if the agent is restarted</description>
    </command>
    
</bergamot>
